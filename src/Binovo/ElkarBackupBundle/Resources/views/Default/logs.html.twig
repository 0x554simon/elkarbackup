{##
 # @copyright 2012,2013 Binovo it Human Project, S.L.
 # @license http://www.opensource.org/licenses/bsd-license.php New-BSD
 #}
{% extends 'BinovoElkarBackupBundle:Default:base.html.twig' %}
{% trans_default_domain 'BinovoElkarBackup' %}

{% block body %}

<script>
var ws = new WebSocket('ws://' + (location.host + ":8080") + "/");
ws.onmessage = function(event) {
    var logrecord = JSON.parse(event.data);
    var table =  document.getElementById("tLogs");
    var row = table.insertRow(1);
    if (logrecord['levelName'] == 'ERROR'){
        row.className = 'danger';
    } else if (logrecord['levelName'] == 'WARNING'){
        row.className = 'warning';
    } else if (logrecord['message'] == 'OK') {
        row.className = 'success';
    }
    var cell1 = row.insertCell(0);
    var cell2 = row.insertCell(1);
    var cell3 = row.insertCell(2);
    var cell4 = row.insertCell(3);
    var cell5 = row.insertCell(4);
    var cell6 = row.insertCell(5);
    var logdate = logrecord['dateTime'];
    cell1.innerHTML = `{% set logdate = '${logdate}'  %} {{ logdate.date|date('Y-m-d H:i:s') }}`;
    cell2.innerHTML = logrecord['levelName'];
    cell3.innerHTML = logrecord['source'];
    cell4.innerHTML = logrecord['userName'];
    cell5.innerHTML = logrecord['message'];
    if (logrecord['link']){
        cell6.innerHTML = "<a href=\""+logrecord['link']+"\">"+logrecord['link']+"<\a>";
    }
}
</script>

<h3>{% trans %}Logs{% endtrans %}</h3>

<form action="{{ path('showLogs') }}">
<table id="tLogs" class="table table-condensed table-hover table-striped">
    <tr>
        {# sorting of properties based on query components #}
        <th>{% trans %}Time{% endtrans %}</th>
        <th style="width: 160px;">{% trans %}Level{% endtrans %}<br />
            {{ filterSelect(levels, {style: "width: 150px;"}) }}</th>
        <th>{% trans %}Source{% endtrans %}<br />
            {{ filterSelect(source, {style: "width: 150px;"}) }}</th>
        <th>{% trans %}User{% endtrans %}</th>
        <th>{% trans %}Message{% endtrans %}</th>
        <th>{% trans %}Object{% endtrans %}<br />
            {{ filterText(object, {style: "width: 150px;"}) }}</th>
    </tr>

    {# table body #}
    {% for logRecord in pagination %}
    <tr class="
    {% if (logRecord.levelName) == 'ERROR'%}danger {% endif %}
    {% if (logRecord.levelName) == 'WARNING'%}warning {% endif %}
		{% if (logRecord.message) == 'OK'%}success {% endif %}
    logs" >

        <td style="white-space: nowrap;">{{ logRecord.dateTime.format('Y-m-d H:i:s') }}</td>
        <td>{{ logRecord.levelName }}</td>
        <td>{{ logRecord.source }}</td>
        <td>{{ logRecord.userName }}</td>
        <td>{{ logRecord.message }}</td>
        <td style="white-space: nowrap;">{% if logRecord.link %}<a href="{{ logRecord.link }}">{{ logRecord.link }}</a>{% endif %}</td>
    </tr>
    {% endfor %}
</table>
</form>
<div class="navigation binovo-pagination">
    {{ pagination.render()|raw }}
</div>


{% endblock %}
